<!-- Embed this in Webflow's Embed Block -->
<div class="custom-animation">
    <div class="main-container">
        <div class="container"></div>
        <div class="state-list"></div>
    </div>
    <style>
        .custom-animation {
            width: 100%;
            height: 100vh;
            position: relative;
            background: transparent;
            overflow: hidden;
        }

        /* Main container for the image and state list */
        .custom-animation .main-container {
            display: flex;
            flex-direction: row; /* Desktop layout */
            width: 100%;
            height: 100%;
        }

        /* Animation container */
        .custom-animation .container {
            position: relative;
            flex: 1;
            width: 100%;
            overflow: hidden;
        }

        /* Center each frame absolutely within the container */
        .custom-animation .frame {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 100%;
            height: 100%;
            opacity: 0;
            transition: opacity 0.2s ease-in-out;
        }

        .custom-animation .frame img {
            display: block;
            width: 100%;
            height: 100%;
            object-fit: contain; /* Maintain aspect ratio */
        }

        /* State list (desktop: vertical on the left) */
        .custom-animation .state-list {
            display: flex;
            flex-direction: column; /* Vertical layout */
            align-items: flex-start; /* Left-align items */
            justify-content: flex-start;
            overflow-y: auto;
            overflow-x: hidden;
            width: 15%;
            padding: 10px;
            background: transparent; /* No background or shadow */
        }

        /* State item */
        .custom-animation .state-item {
            margin: 5px 0;
            font-family: 'IBM Plex Mono', monospace;
            font-size: 1rem;
            color: black;
            opacity: 0.5; /* Default opacity for inactive states */
            transition: opacity 0.3s ease, transform 0.3s ease;
            cursor: pointer;
        }

        /* Highlighted active state */
        .custom-animation .state-item.active {
            opacity: 1;
            transform: scale(1.1);
        }

        /* Horizontal list for mobile */
        @media (max-width: 900px) {
            .custom-animation .main-container {
                flex-direction: column; /* Stack vertically on mobile */
            }

            .custom-animation .state-list {
                flex-direction: row; /* Horizontal layout */
                justify-content: flex-start;
                align-items: center;
                overflow-x: auto; /* Allow horizontal scrolling */
                overflow-y: hidden;
                width: 100%;
                padding: 10px;
                white-space: nowrap;
            }

            .custom-animation .state-item {
                display: inline-block; /* Inline for horizontal scrolling */
                margin: 0 10px;
                font-size: 0.9rem;
            }
        }
    </style>
    <script>
        document.addEventListener("DOMContentLoaded", function () {
            const container = document.querySelector(".custom-animation .container");
            const stateList = document.querySelector(".custom-animation .state-list");
            const frames = [];
            const stateItems = [];
            const scrollThreshold = 100; // Sensitivity for scroll progression
            let scrollDelta = 0; // Accumulated scroll value
            let currentFrameIndex = 0; // Start at Frame 0

            // Define custom names for the frames (including Frame 0)
            const frameNames = [
                "00_KHAOS",
                "01_VOID",
                "02_AETHER",
                "03_FLARE",
                "04_FUSION",
                "05_TERRA",
                "06_AQUA",
                "07_PLASMA_LUX",
                "08_GAIA",
                "09_ANIMA",
                "10_ARCHE",
                "11_MATERIA",
                "12_PRESENCE",
                "13_KHAOS_REBORN",
                "14_DARK_MATTER",
                "15_ANTIMATTER",
                "16_SYNTHESIS",
                "17_GENIUS_LOCI",
                "18_CHRONOS",
                "19_ETHOS",
                "20_UNIVERSE",
                "21_HARMONY",
            ];

            // Create frames and state items
            frameNames.forEach((name, index) => {
                // Create frame
                const frame = document.createElement("div");
                frame.className = "frame";
                frame.style.zIndex = frameNames.length - index;

                if (index > 0) {
                    const img = document.createElement("img");
                    img.src = `https://example.com/sigil_${index}.png`; // Replace with correct Webflow asset paths
                    img.alt = name;
                    img.onerror = () => {
                        console.error(`Image not found: sigil_${index}.png`);
                        frame.style.display = "none"; // Hide frame if image is missing
                    };
                    frame.appendChild(img);
                }

                container.appendChild(frame);
                frames.push(frame);

                // Create state item
                const stateItem = document.createElement("div");
                stateItem.className = "state-item";
                stateItem.textContent = name;
                stateList.appendChild(stateItem);
                stateItems.push(stateItem);

                // Click handler
                stateItem.addEventListener("click", () => {
                    currentFrameIndex = index;
                    updateActiveFrame(index);
                });
            });

            // Update active frame
            function updateActiveFrame(index) {
                frames.forEach((frame, i) => {
                    frame.style.opacity = i <= index ? "1" : "0";
                });

                stateItems.forEach((item, i) => {
                    item.classList.toggle("active", i === index);
                });

                // Sync horizontal scroll position (mobile)
                if (window.innerWidth <= 900) {
                    const activeItem = stateItems[index];
                    if (activeItem) {
                        const offset =
                            activeItem.offsetLeft +
                            activeItem.offsetWidth / 2 -
                            window.innerWidth / 2;
                        stateList.scrollTo({
                            left: offset,
                            behavior: "smooth",
                        });
                    }
                }
            }

            // Scroll handling
            window.addEventListener("wheel", (event) => {
                scrollDelta += event.deltaY;

                if (Math.abs(scrollDelta) >= scrollThreshold) {
                    const direction = scrollDelta > 0 ? 1 : -1;
                    let newFrameIndex = currentFrameIndex + direction;

                    // Infinite scrolling logic
                    if (newFrameIndex > frames.length - 1) {
                        newFrameIndex = 0;
                    } else if (newFrameIndex < 0) {
                        newFrameIndex = frames.length - 1;
                    }

                    currentFrameIndex = newFrameIndex;
                    updateActiveFrame(newFrameIndex);

                    scrollDelta = 0;
                }
            });

            updateActiveFrame(0); // Initialize
        });
    </script>
</div>
